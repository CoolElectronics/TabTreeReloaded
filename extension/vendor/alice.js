(()=>{var g=[],E=Symbol(),_=Symbol(),x=Symbol();Object.defineProperty(window,"use",{get:()=>(g=[],(r,s)=>{let n=g;return g=[],n[_]=!0,s&&(n[E]=s),n})});Object.assign(window,{h:j,html:N,stateful:O,handle:h,useValue:A,css:w,styled:{new:w}});function O(r){return r[x]=[],new Proxy(r,{get(n,e,c){return g.push({target:n,property:e,proxy:c}),Reflect.get(n,e,c)},set(n,e,c){for(let t of n[x])t(n,e,c);return Reflect.set(n,e,c)}})}function p(r){return r instanceof Array&&_ in r}function h(r,s){if(!p(r))throw new Error("Not an AliceJS reference set!");if(E in r){let n=r[E],e=[],c=[],t=new Map,o=[],i=(f,l,d)=>{e.includes(l)&&c.includes(f)&&(t.get(f)[l]=d)},a=()=>{let f=o.map(d=>t.get(d[0])[d[1]]),l=n(...f.reverse());s(l)};for(let f of r){let l=f.target,d=f.property;e.push(d),c.push(l),o.push([l,d]),t.has(l)||t.set(l,{}),i(l,d,l[d]),l[x].push((u,b,m)=>{i(u,b,m),a()})}a()}else{let n=r[r.length-1],e=(c,t,o)=>{t===n.property&&c===n.target&&s(o)};n.target[x].push(e),e(n.target,n.property,n.target[n.property])}}function A(r){let s=r[r.length-1];return s.proxy[s.property]}function j(r,s,...n){if(typeof r=="function"){let t=O(Object.create(r.prototype));for(let a in s){let f=s[a];if(p(f)&&a.startsWith("bind:")){let l=f[f.length-1],d=a.substring(5);if(d=="this")l.proxy[l.property]=t;else{let u=!1;h(f,b=>{if(u){u=!1;return}u=!0,t[d]=b}),h(use(t[d]),b=>{if(u){u=!1;return}u=!0,l.proxy[l.property]=b})}delete s[a]}}Object.assign(t,s);let o=[];for(let a of n)y(a,o.push.bind(o));let i=r.apply(t,[o]);return i.$=t,t.root=i,i}let e=document.createElement(r);for(let t of n)y(t,e.appendChild.bind(e));if(!s)return e;function c(t,o){if(!(t in s))return;let i=s[t];o(i),delete s[t]}if(c("before",t=>{y(t())}),c("if",t=>{let o=s.then,i=s.else;if(p(t))o&&e.appendChild(o),i&&e.appendChild(i),h(t,a=>{o?a?(o.style.display="",i&&(i.style.display="none")):(o.style.display="none",i&&(i.style.display="")):a?e.style.display="":e.style.display="none"});else if(o)t?e.appendChild(o):i&&e.appendChild(i);else if(t)e.appendChild(o);else if(i)e.appendChild(i);else return e.style.display="none",document.createTextNode("");delete s.then,delete s.else}),"for"in s&&"do"in s){let t=s.for,o=s.do;if(p(t)){let i=[],a=[];h(t,f=>{if(Object.keys(f).length&&Object.keys(f).length==a.length){let l=0;for(let d in f){if(v(f[d],a[d]))continue;let u=o(f[d],d,f);e.replaceChild(u,i[l]),i[l]=u,l+=1}a=Object.keys(JSON.parse(JSON.stringify(f)))}else{for(let l of i)l.remove();for(let l in f){let d=f[l],u=o(d,l,f);u instanceof HTMLElement&&(i.push(u),e.appendChild(u))}a=[]}})}else for(let i in t){let a=t[i],f=o(a,i,t);f instanceof Node&&e.appendChild(f)}delete s.for,delete s.do}c("after",t=>{y(t())});for(let t in s){let o=s[t];if(p(o)&&t.startsWith("bind:")){let i=o[o.length-1],a=t.substring(5);a=="this"?i.proxy[i.property]=e:a=="value"?(h(o,f=>e.value=f),e.addEventListener("change",()=>{i.proxy[i.property]=e.value})):a=="checked"&&(h(o,f=>e.checked=f),e.addEventListener("click",()=>{i.proxy[i.property]=e.checked})),delete s[t]}}for(let t in s){let o=s[t];p(o)?h(o,i=>{C(e,t,i)}):C(e,t,o)}return c("css",t=>{e.classList.add(t),e.classList.add("self")}),e}function y(r,s){if(p(r)){let n=[];h(r,e=>{if(n.length>1)n.forEach(c=>c.remove()),n=y(e,s);else if(n.length>0){let c=n[0];n=y(e,s),n[0]?c.replaceWith(n[0]):c.remove()}else n=y(e,s)})}else{if(r instanceof Node)return s(r),[r];if(r instanceof Array){let n=[];for(let e of r)n=n.concat(y(e,s));return n}else{let n=document.createTextNode(r);return s(n),[n]}}}function C(r,s,n){if(s==="class"){r.className=n;return}if(typeof n=="function"&&s==="mount"){n(r);return}if(typeof n=="function"&&s.startsWith("on:")){let e=s.substring(3);for(let c of e.split("$"))r.addEventListener(c,(...t)=>{window.$el=r,n(...t)});return}if(typeof n=="function"&&s.startsWith("observe")){let e=window[`${s.substring(8)}Observer`];if(!e){console.error(`Observer ${s} does not exist`);return}new e(t=>{for(let o of t)window.$el=r,n(o)}).observe(r);return}r.setAttribute(s,n)}function S(r,s){let n=document.implementation.createHTMLDocument(""),e=document.createElement("style");n.body.appendChild(e);let c="";e.textContent=s;for(let t of e.sheet.cssRules)t.selectorText=t.selectorText.includes("self")?`.${r}.self${t.selectorText.replace("self","")}`:`.${r} ${t.selectorText}`,c+=`${t.cssText}
`;return c}function w(r,...s){let n=`alicecss-${Array(16).fill(0).map(()=>Math.floor(Math.random()*16).toString(16)).join("")}`,e=document.createElement("style");document.head.appendChild(e);let c=[];for(let t in r)if(c.push(r[t]),s[t]){let o=s[t];if(p(o)){let i=c.length,a;h(o,f=>{c[i]=String(f);let l=c.join("");l!=a&&(e.textContent=S(n,l)),a=l})}else c.push(String(o))}return e.textContent=S(n,c.join("")),n}function N(r,...s){let n="",e={};for(let o in r){let i=r[o],a=s[o];if(n+=i,o<s.length){let f=Object.values(e).findIndex(l=>l==a);if(f!==-1)n+=Object.keys(e)[f];else{let l="m"+Array(16).fill(0).map(()=>Math.floor(Math.random()*16).toString(16)).join("");e[l]=a,n+=l}}}let c=new DOMParser().parseFromString(n,"text/html");if(c.body.children.length!==1)throw"html builder needs exactly one child";function t(o){let i=o.nodeName.toLowerCase();if(i==="#text")return o.textContent;i in e&&(i=e[i]);let a=[...o.childNodes].map(t);for(let l=0;l<a.length;l++){let d=a[l];if(typeof d=="string")for(let[u,b]of Object.entries(e)){if(!d)break;if(!d.includes(u))continue;let m;[m,d]=d.split(u),a=[...a.slice(0,l),m,b,d,...a.slice(l+1)],l+=2}}let f={};for(let l of[...o.attributes]){let d=l.nodeValue;d in e&&(d=e[d]),f[l.name]=d}return j(i,f,a)}return t(c.body.children[0])}function v(r,s){let n=Object.keys(r),e=Object.keys(s);if(n.length!==e.length)return!1;for(let c of n){let t=r[c],o=s[c],i=k(t)&&k(o);if(i&&!v(t,o)||!i&&t!==o)return!1}return!0}function k(r){return r!=null&&typeof r=="object"}})();
